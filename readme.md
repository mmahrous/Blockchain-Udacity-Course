# BlockChain API

BlockChain web service, this service enable you to be programaticlly interface with our BlockChain.

## API specs
This uses hapijs https://hapijs.com and Joijs to validate the data.

## API documentation
This api is accessible through `HTTP` API endpoint `http://localhost:8000`

### Routes
### Request validate
```
POST /requestValidation
```
#### Payload
```JSON
{
	"address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1"
}
```
#### Response [200]
```JSON
{
    "walletAddress": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
    "requestTimeStamp": 1544303086760,
    "message": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1:1544303086760:starRegistry",
    "validationWindow": 300
}
```
----
### Message signature validate
```
POST /message-signature/validate
```
you can obtaine signature from electrum for example using the message generated by `/requestValidation`
#### Payload
```JSON
{
	"address":"1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
	"signature":"IJL4vR3la36kv0UKihOJOHiHU5NovHhWmALf1qVe8ZPYQduj9g/EWrkhtMT7vswDstAh0lH1xCDsMH9z7jKHagg="
}
```
#### Response [200]
when valid entry added to mempool with wallet address
```JSON
{
    "registerStar": true,
    "status": {
        "address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
        "requestTimeStamp": 1544303086760,
        "message": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1:1544303086760:starRegistry",
        "validationWindow": 130.08,
        "messageSignature": true
    }
}
```

#### Response [400]
Address did't request validation before
```JSON
{
    "statusCode": 400,
    "error": "Not valid",
    "message": "This signature is not valid."
}
```
----
### Get Star with hash
```
GET /stars/hash:{hash}
```
#### Params
```
hash: is string
```
#### Response [200]
```JSON
{
    "height": 1,
    "timeStamp": "154430211286",
    "body": {
        "address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
        "star": {
            "dec": "68° 52' 56.9",
            "ra": "16h 29m 1.0s",
            "story": "466f756e642073746172207573696e672068747470733a2f2f7777772e676f6f676c652e636f6d2f736b792f",
            "storyDecoded": "Found star using https://www.google.com/sky/"
        }
    },
    "previousHash": "91874c54a1982741d3b35293746373afdd6ec2a76201c37db13535b8573f1049",
    "hash": "cd246c4d54b29cb662959b2ad0726294186043357688a4856eaf13bf94d3464c"
}
```

#### Response [404]
Block is not present in the chains
```JSON
{
    "statusCode": 404,
    "error": "Not found",
    "message": "block not found."
}
```
----
### Get Stars with wallet address
```
GET /stars/address:{address}
```
#### Params
```
address: is string
```
#### Response [200]
```JSON
[
    {
        "height": 1,
        "timeStamp": "154430211286",
        "body": {
            "address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
            "star": {
                "dec": "68° 52' 56.9",
                "ra": "16h 29m 1.0s",
                "story": "466f756e642073746172207573696e672068747470733a2f2f7777772e676f6f676c652e636f6d2f736b792f",
                "storyDecoded": "Found star using https://www.google.com/sky/"
            }
        },
        "previousHash": "91874c54a1982741d3b35293746373afdd6ec2a76201c37db13535b8573f1049",
        "hash": "cd246c4d54b29cb662959b2ad0726294186043357688a4856eaf13bf94d3464c"
    },
    {
        "height": 2,
        "timeStamp": "154430227518",
        "body": {
            "address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
            "star": {
                "dec": "68° 52' 56.9",
                "ra": "16h 29m 1.0s",
                "story": "466f756e642073746172207573696e672068747470733a2f2f7777772e676f6f676c652e636f6d2f736b792f",
                "storyDecoded": "Found star using https://www.google.com/sky/"
            }
        },
        "previousHash": "cd246c4d54b29cb662959b2ad0726294186043357688a4856eaf13bf94d3464c",
        "hash": "5da0f77f58d0fdb596e08a69fa94647607c30e3acf1530e1773a9f7113701446"
    }
]
```

#### Response [404]
Block is not present in the chains
```JSON
{
    "statusCode": 404,
    "error": "Not found",
    "message": "blocks not found."
}
```
----
### Get Block with height
```
GET /block/{height}
```
#### Params
```
height: is number
```
#### Response [200]
```JSON
{
    "height": 0,
    "timeStamp": "154179346335",
    "body": "First block in the chain - Genesis block",
    "previousHash": "0x",
    "hash": "4e1b401f1e7207629f1cc693e4e8b1dbb8ac3c48bd8c8b7e7afefed88bda9f0b"
}
```

#### Response [400]
Height is not a number
```JSON
{
    "statusCode": 400,
    "error": "Bad Request",
    "message": "block height is always a number.",
    "validation": {
        "source": "params",
        "keys": []
    }
}
```

#### Response [404]
Block is not present in the chains
```JSON
{
    "statusCode": 404,
    "error": "Not found",
    "message": "block not found."
}
```
----
### Create new block
```
POST /block
```
You need to validate the request with address first
#### Payload
```JSON
{
	"address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
    "star": {
            "dec": "68° 52' 56.9",
            "ra": "16h 29m 1.0s",
            "story": "Found star using https://www.google.com/sky/"
        }
}
```
#### Response [201]
Block added to the chain.
```JSON
{
    "height": 2,
    "timeStamp": "154430227518",
    "body": {
        "address": "1JkfB3g24Ms9AzkQVn3iBeAzcgMuU7gBC1",
        "star": {
            "dec": "68° 52' 56.9",
            "ra": "16h 29m 1.0s",
            "story": "466f756e642073746172207573696e672068747470733a2f2f7777772e676f6f676c652e636f6d2f736b792f",
            "storyDecoded": "Found star using https://www.google.com/sky/"
        }
    },
    "previousHash": "cd246c4d54b29cb662959b2ad0726294186043357688a4856eaf13bf94d3464c",
    "hash": "5da0f77f58d0fdb596e08a69fa94647607c30e3acf1530e1773a9f7113701446"
}
```

#### Response [400]
Star or Address is not present
```JSON
{
    "statusCode": 400,
    "error": "Bad Request",
    "message": "star is required to consider it add it to the chain.",
    "validation": {
        "source": "payload",
        "keys": []
    }
}
```
----
Developed by M.Mahrous
